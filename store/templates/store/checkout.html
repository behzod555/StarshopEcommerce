
{% extends 'store/main.html' %}
{% load static %}
{% block content %}

		<!-- Breadcrumbs -->
		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col-12">
						<div class="bread-inner">
							<ul class="bread-list">
								<li><a href="index1.html">Home<i class="ti-arrow-right"></i></a></li>
								<li class="active"><a href="blog-single.html">Checkout</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End Breadcrumbs -->
				<section class="shop checkout section">
			<div class="container">
				<div class="row"> 
					<div class="col-lg-8 col-12">
						<div class="checkout-form">
							<h2>Make Your Checkout Here</h2>
							<p>Please register in order to checkout more quickly</p>
							<!-- Form -->
							<form class="form" method="POST" action="#" id="form">
								<div class="row">

									<div class="col-lg-6 col-md-6 col-12" id="user-info">
										<div class="form-group">
											<label>Имя<span>*</span></label>
											<div>
											<input type="text" name="name" placeholder="" required="required"></div>
										</div>
									</div>
									<div class="col-lg-6 col-md-6 col-12" id="user-info">
										<div class="form-group">
											<label>Фамилия<span>*</span></label><div>
											<input type="text" name="surname" placeholder="" required="required"></div>
										</div>
									</div>
									<div class="col-lg-6 col-md-6 col-12" id="user-info">
										<div class="form-group">
											<label>Email<span>*</span></label><div>
											<input type="email" name="email" placeholder="" required="required"></div>
										</div>
									</div>
									<div class="col-lg-6 col-md-6 col-12" id="user-info shipping-info">
										<div class="form-group">
											<label>Номер телефона<span>*</span></label><div>
											<input type="number" name="number" placeholder="" required="required"></div>
										</div>
									</div>
									<div class="col-lg-6 col-md-6 col-12" id="shipping-info">
										<div class="form-group">
											<label>Город<span>*</span></label><div>
											<input type="text" name="city" placeholder="" required="required"></div>
										</div>
									</div>
									<div class="col-lg-6 col-md-6 col-12" id="shipping-info">
										<div class="form-group">
											<label>State<span>*</span></label><div>
											<input type="text" name="state" placeholder="" required="required"></div>
										</div>
									</div>
									
									<div class="col-lg-6 col-md-6 col-12" id="shipping-info">
										<div class="form-group">
											<label>Адрес<span>*</span></label><div>
											<input type="text" name="address" placeholder="" required="required"></div>
										</div>
									</div>
									<div class="col-lg-6 col-md-6 col-12" id="shipping-info">
										<div class="form-group">
											<label>Адрес-2<span>*</span></label><div>
											<input type="text" name="address1" placeholder="" required="required"></div>
										</div>
									</div>
										</div>

									<!--<input id="form-button" class="btn btn-success btn-block" style="width:80%" type="submit" value="Continue">-->
							
						<!--	<div class="box-element" id="payment-info">
				<small>Paypal Options</small>
				<button id="make-payment">Make payment</button
				 <div id="paypal-button-container"></div>
			</div>-->
							<!--/ End Form -->
						</div>
					</div>
					<div class="col-lg-4 col-12">
						<div class="order-details">
							<!-- Order Widget -->
							<div class="single-widget">
								<h2>CART  TOTALS</h2>
								<div class="content">
									<ul>
										<li>Sub Total<span>${{order.get_cart_total|floatformat:2}}</span></li>
										<li>(+) Shipping<span>$10.00</span></li>
										<li class="last">Total<span>${{order.get_cart_total|floatformat:2}}</span></li>
									</ul>
								</div>
							</div>
							<!--/ End Order Widget -->
							<!-- Order Widget -->
							<div class="single-widget">
								<h2>Payments</h2>
								<div class="content">
									<div class="checkbox">
										<label class="checkbox-inline" for="1"><input name="updates" id="1" type="checkbox"> Check Payments</label>
										<label class="checkbox-inline" for="2"><input name="news" id="2" type="checkbox"> Cash On Delivery</label>
										<label class="checkbox-inline" for="3"><input name="news" id="3" type="checkbox"> PayPal</label>
									</div>
								</div>
							</div>
							<!--/ End Order Widget -->
							<!-- Payment Method Widget -->
							<div class="single-widget payement">
								<div class="content">
									<img src="images/payment-method.png" alt="#">
								</div>
							</div>
							<!--/ End Payment Method Widget -->
							<!-- Button Widget -->
							<div class="single-widget get-button">
								<div class="content">
									<div class="button">
										<a href="#" class="btn"  id="make-payment">proceed to checkout</a>
									</div>
								</div>
							</div>
							<!--/ End Button Widget -->
						</div>
					</div>
				</div>
			</div>
		</section>
					<!-- Shopping Summery -->
					<!--<table class="table shopping-summery">
						<thead>
							<tr class="main-hading">
								<th>PRODUCT</th>
								<th>NAME</th>
								<th class="text-center">UNIT PRICE</th>
								<th class="text-center">QUANTITY</th>
								<th class="text-center">TOTAL</th> 
								<th class="text-center"><i class="ti-trash remove-icon"></i></th>
							</tr>
						</thead>
						<tbody>
							{% for item in items %}
							<tr>
								<td class="image" data-title="No"><img src="{{item.product.imageURL}}" alt="#"></td>
								<td class="product-des" data-title="Description">
									<p class="product-name"><a href="#">{{item.product.name}}</a></p>
									<p class="product-des">Maboriosam in a tonto nesciung eget  distingy magndapibus.</p>
								</td>
								<td class="price" data-title="Price"><span>${{item.product.price}} </span></td>
								<td class="qty" data-title="Qty">
								<div style="flex:1" class="cart-row">
									<p class="quantity" style="font-size: 20px;">{{item.quantity}}</p>
									<div class="quantity">
									<img style="width:10px;height:10px;" data-product="{{item.product.id}}" data-action="add" class="chg-quantity update-cart" src="{% static  'images/arrow-up.png' %}">
					
									<img style="width:10px;height:10px;" data-product="{{item.product.id}}" data-action="remove" class="chg-quantity update-cart" src="{% static  'images/arrow-down.png' %}">
									</div>
								</div>
									
									
								</td>
								<td class="total-amount" data-title="Total"><span>${{item.get_total|floatformat:2}}</span></td>
								<td class="action chg-quantity update-cart"  data-title="Remove" data-product="{{item.product.id}}" data-action="delete"><a href="/update-cart"><i class="ti-trash remove-icon"></i></a></td>
							</tr>
							{% endfor %}
						</tbody>
					</table>-->
		<!-- Start Checkout -->

<!--		<section class="shop checkout section">
			<div class="container">
				<div class="row"> 
					<div class="col-lg-8 col-12">
						<div class="checkout-form">
						
							<p>Please register in order to checkout more quickly</p>
							
							<form class="form" method="post" action="#" id="form">
								
								
									<div id="shipping-info">
								<div id="user-info">		
											<div class="row">				
									<div class="col-lg-6 col-md-6 col-12">
										
										<div class="form-group">
											<label>Имя<span>*</span></label>
											<input type="text" name="name" placeholder="" required="required">
										</div>
									
									<div class="col-lg-6 col-md-6 col-12">
										<div class="form-group">
											<label>Фамилия<span>*</span></label>
											<input type="text" name="surname" placeholder="" required="required">
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-lg-6 col-md-6 col-12">
										<div class="form-group">
											<label>Email<span>*</span></label>
											<input type="email" name="email" placeholder="" required="required">
										</div>
									</div>
								</div>

							

								
									<div class="col-lg-6 col-md-6 col-12">
										<div class="form-group">
											<label>Номер телефона<span>*</span></label>
											<input type="text" name="number" placeholder="" required="required">
										</div>
									</div>
								</div>

									<div class="col-lg-6 col-md-6 col-12">

										<div class="form-group">
											<label>Адрес<span>*</span></label>
											<input type="text"  name="address" placeholder="" required="required">
										</div>
									</div>
									<div class="col-lg-6 col-md-6 col-12">
										<div class="form-group">
											<label>Город<span>*</span></label>
											<input type="text" name="city" placeholder="" >
										</div>
									</div>
									<div class="col-lg-6 col-md-6 col-12">
										<div class="form-group">
											<label>Область<span>*</span></label>
											<input type="text" name="state" placeholder="" required="required">
										</div>
									</div>
										</div>
								
									<input id="form-button" class="btn btn-success btn-block" type="submit" value="Continue">
								</div>
							</form>
							<div class="box-element" id="payment-info">
				<small>Paypal Options</small>
				<button id="make-payment">Make payment</button
				 <div id="paypal-button-container"></div>
			</div>
			</div>
		
					
						</div>
					</div>
					<div class="col-lg-4 col-12">
						<div class="order-details">
						
							<div class="single-widget">
								<h2>CART  TOTALS</h2>
								<div class="content">
									<ul>
								<li>Sub Total<span>${{order.get_cart_total|floatformat:2}}</span></li>
										<li>(+) Shipping<span>$10.00</span></li>
										<li class="last">Total<span>${{order.get_cart_total|floatformat:2}}</span></li>
									</ul>
								</div>
							</div>
						
							<div class="single-widget">
								<h2>Payments</h2>
								<div class="content">
									<div class="checkbox">
										<label class="checkbox-inline" for="1"><input name="updates" id="1" type="checkbox"> Check Payments</label>
										<label class="checkbox-inline" for="2"><input name="news" id="2" type="checkbox"> Cash On Delivery</label>
										<label class="checkbox-inline" for="3"><input name="news" id="3" type="checkbox"> PayPal</label>
									</div>
								</div>
							</div>

						
							<div class="single-widget payement">
								<div class="content">
									<img src="images/payment-method.png" alt="#">
								</div>
							</div>
							
							<div class="single-widget get-button">
								<div class="content">
									<div class="button">
										<input id="form-button" class="btn btn-success btn-block" type="submit" value="Continue">
									</div>
								</div>
							</div>
						</form>
							
						</div>
					</div>
				</div>
			</div>
		</section>-->
		<!--/ End Checkout -->
		

	<!--<script type="text/javascript">
		
		var form = document.getElementById('form')
		form.addEventListener('submit', function(e){
	    	e.preventDefault()
	    	console.log('Form Submitted...')
	    	submitFormData()
	    	
	    })

	   /*document.getElementById('form').addEventListener('click', function(e){
	    	submitFormData()
	    })
	    */

	    function submitFormData(){
	    	console.log('Payment button clicked')

	    	var userFormData = {
				'name':null,
				'email':null,
				
			}

			var shippingInfo = {
				'address':null,
				'city':null,
				'state':null,
				
			}

			
	    	shippingInfo.address = form.address.value
		    shippingInfo.city = form.city.value
		    shippingInfo.state = form.state.value
		    
	    	}

	    	if (user == 'AnonymousUser'){
	    		userFormData.name = form.name.value
	    		userFormData.email = form.email.value
	    	}

	    	console.log('Shipping Info:', shippingInfo)
	    	console.log('User Info:', userFormData)

	    	var url = "/process_order/"
	    	fetch(url, {
	    		method:'POST',
	    		headers:{
	    			'Content-Type':'applicaiton/json',
	    			'X-CSRFToken':csrftoken,
	    		}, 
	    		body:JSON.stringify({'form':userFormData, 'shipping':shippingInfo}),
	    		
	    	})
	    	.then((response) => response.json())
	    	.then((data) => {
				console.log('Success:', data);
				alert('Transaction completed');  

				cart = {}
				document.cookie ='cart=' + JSON.stringify(cart) + ";domain=;path=/"

				window.location.href = "{% url 'store' %}"

				})

	</script>-->

	<!--<script type="text/javascript">
			
	    document.getElementById('form-button').addEventListener('click', function(e){
	    	submitFormData()
	    })
	   

	    function submitFormData(){
	    	console.log('Payment button clicked')

	    	var userFormData = {
				'name':null,
				'email':null,
							}

			var shippingInfo = {
				'address':null,
				'city':null,
				'state':null,
			
			}

			
	    	shippingInfo.address = form.address.value
		    shippingInfo.city = form.city.value
		    shippingInfo.state = form.state.value
		    	
	    	

	    	
	    	userFormData.name = form.name.value
	    	userFormData.email = form.email.value
	    	

	    	console.log('Shipping Info:', shippingInfo)
	    	console.log('User Info:', userFormData)

	    	var url = "/process_order/"
	    	fetch(url, {
	    		method:'POST',
	    		headers:{
	    			'Content-Type':'applicaiton/json',
	    			'X-CSRFToken':csrftoken,
	    		}, 
	    		body:JSON.stringify({'form':userFormData, 'shipping':shippingInfo}),
	    		
	    	})
	    	.then((response) => response.json())
	    	.then((data) => {
				console.log('Success:', data);
				alert('Transaction completed');  

				cart = {}
				document.cookie ='cart=' + JSON.stringify(cart) + ";domain=;path=/"

				window.location.href = "{% url 'store' %}"

				})
	    }
	</script>-->
	<script type="text/javascript">

		function getToken(name) {
		    var cookieValue = null;
		    if (document.cookie && document.cookie !== '') {
		        var cookies = document.cookie.split(';');
		        for (var i = 0; i < cookies.length; i++) {
		            var cookie = cookies[i].trim();
		            // Does this cookie string begin with the name we want?
		            if (cookie.substring(0, name.length + 1) === (name + '=')) {
		                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		                break;
		            }
		        }
		    }
		    return cookieValue;
		}
		var csrftoken = getToken('csrftoken')

		
		var total = '{{order.get_cart_total}}'
		

		
		var form = document.getElementById('form')
		form.addEventListener('submit', function(e){
	    	e.preventDefault()
	    	console.log('Form Submitted...')
	    	
	    })

	   document.getElementById('make-payment').addEventListener('click', function(e){
	    	submitFormData()
	    })
	    

	    function submitFormData(){
	    	console.log('Payment button clicked')

	    	var userFormData = {
				'name':null,
				'surname':null,
				'email':null,
				'total':total,
				
			}

			var shippingInfo = {
				'name':null,
				'surname':null,
				'email':null,
				'number':null,
				'address':null,
				'city':null,
				'state':null,
				
			}

	    	shippingInfo.address = form.address.value
		    shippingInfo.city = form.city.value
		    shippingInfo.state = form.state.value
		    shippingInfo.number = form.number.value
		    	
	    	

	 	    userFormData.name = form.name.value
	    	userFormData.surname = form.surname.value
	    	userFormData.email = form.email.value
	    	
	    	

	    	console.log('Shipping Info:', shippingInfo)
	    	console.log('User Info:', userFormData)

	    	var url = "/process_order/"
	    	fetch(url, {
	    		method:'POST',
	    		headers:{
	    			'Content-Type':'applicaiton/json',
	    			'X-CSRFToken':csrftoken,
	    		}, 
	    		body:JSON.stringify({'form':userFormData, 'shipping':shippingInfo}),
	    		
	    	})
	    	
	    	.then((data) => {
				console.log('Success:', data);
				alert('Transaction completed');  

				cart = {}
				document.cookie ='cart=' + JSON.stringify(cart) + ";domain=;path=/"

				window.location.href = "{% url 'store' %}"

				})
	    }
	</script>


{% endblock content %}


 
